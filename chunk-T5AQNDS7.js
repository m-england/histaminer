import{$ as A,Aa as G,Ba as H,Ca as J,Da as K,E as P,F as y,H as C,I as f,J as N,K as O,L as k,M as a,N as r,O as R,P as b,Q as g,R as d,V as s,W as M,X as z,Y as E,Z as w,_ as F,a as v,b as T,ba as D,ca as S,fa as j,ja as $,ka as B,la as W,o as x,oa as L,q as p,r as _,u as I,va as X,w as c,xa as Y,y as V,ya as q,za as U}from"./chunk-KSWCHTVU.js";var Z=()=>[1,2,3,4,5],ee=(n,t)=>t.date;function te(n,t){if(n&1){let e=b();a(0,"button",19),g("click",function(){let i=p(e).$implicit,m=d(3);return _(m.onSeverityChange(i))}),R(1,"app-shield-icon",20),r()}if(n&2){let e=t.$implicit,o=d(3);y("active",o.editingReaction().reaction.severity===e),c(),P("severity",e)("size",32)}}function ne(n,t){if(n&1){let e=b();a(0,"div",15)(1,"label",21)(2,"input",22),F("ngModelChange",function(i){p(e);let m=d(3);return w(m.editingReaction().isImmediateReaction,i)||(m.editingReaction().isImmediateReaction=i),_(i)}),g("ngModelChange",function(){p(e);let i=d(3);return _(i.onReactionTypeClick())}),r(),a(3,"span"),s(4,"\u{1F534} Immediate"),r()(),a(5,"label",23)(6,"input",22),F("ngModelChange",function(i){p(e);let m=d(3);return w(m.editingReaction().isDelayedReaction,i)||(m.editingReaction().isDelayedReaction=i),_(i)}),g("ngModelChange",function(){p(e);let i=d(3);return _(i.onReactionTypeClick())}),r(),a(7,"span"),s(8,"\u23F0 Delayed"),r()()()}if(n&2){let e=d(3);c(),y("active",e.editingReaction().isImmediateReaction),c(),E("ngModel",e.editingReaction().isImmediateReaction),c(3),y("active",e.editingReaction().isDelayedReaction),c(),E("ngModel",e.editingReaction().isDelayedReaction)}}function oe(n,t){if(n&1){let e=b();a(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13),O(4,te,2,4,"button",14,N),r()(),C(6,ne,9,6,"div",15),r(),a(7,"div",16)(8,"button",17),g("click",function(){p(e);let i=d(2);return _(i.saveReaction())}),s(9,"Save"),r(),a(10,"button",18),g("click",function(){p(e);let i=d(2);return _(i.cancelEdit())}),s(11,"Cancel"),r()()()}if(n&2){let e=d(2);c(4),k(A(1,Z)),c(2),f(e.editingReaction().reaction.severity>e.ReactionSeverity.NONE?6:-1)}}function ie(n,t){n&1&&(a(0,"span",29),s(1,"\u{1F7E2} No reaction"),r())}function re(n,t){n&1&&(a(0,"span",31),s(1,"\u26A1 Both"),r())}function ae(n,t){n&1&&(a(0,"span",32),s(1,"\u{1F534} Immediate"),r())}function ce(n,t){n&1&&(a(0,"span",33),s(1,"\u23F0 Delayed"),r())}function de(n,t){if(n&1&&C(0,re,2,0,"span",31)(1,ae,2,0,"span",32)(2,ce,2,0,"span",33),n&2){let e=d(2).$implicit;f(e.isImmediateReaction&&e.isDelayedReaction?0:e.isImmediateReaction?1:e.isDelayedReaction?2:-1)}}function le(n,t){if(n&1&&(a(0,"div",30),s(1),r()),n&2){let e=d(2).$implicit;c(),z(" ",e.notes," ")}}function se(n,t){if(n&1){let e=b();a(0,"div",24)(1,"div",25)(2,"div",26),s(3),D(4,"date"),r(),a(5,"div",27),s(6),D(7,"date"),r()(),a(8,"div",28),g("click",function(i){p(e);let m=d().$implicit,l=d();return _(l.onEditClick(i,m))}),C(9,ie,2,0,"span",29)(10,de,3,1),r()(),C(11,le,2,1,"div",30)}if(n&2){let e=d().$implicit;c(3),M(S(4,4,e.date,"mediumDate")),c(3),M(S(7,7,e.date,"shortTime")),c(3),f(e.reacted?10:9),c(2),f(e.notes?11:-1)}}function me(n,t){if(n&1&&(a(0,"div",9),C(1,oe,12,2,"div",10)(2,se,12,10),r()),n&2){let e=t.$implicit,o=d();y("severity-none",e.severity===o.ReactionSeverity.NONE)("severity-mild",e.severity===o.ReactionSeverity.MILD)("severity-moderate",e.severity===o.ReactionSeverity.MODERATE)("severity-severe",e.severity===o.ReactionSeverity.SEVERE)("severity-extreme",e.severity===o.ReactionSeverity.EXTREME),c(),f(o.editingReaction()!==null&&o.editingReaction().reaction.id===e.id?1:2)}}var Q=class n{ReactionSeverity=G;router=x(L);storage=x(J);notificationService=x(H);food=j.required();maxReactions=10;editingReaction=I(null);get latestReactions(){return[...this.food().interactions].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(0,this.maxReactions)}get reactionsCount(){return this.food().interactions.filter(t=>t.reacted).length}get timelineStyle(){let t=[...this.food().interactions].sort((l,h)=>new Date(l.date).getTime()-new Date(h.date).getTime());if(t.length===0)return{background:"var(--timeline-empty)"};let e=new Date(t[0].date).getTime(),i=new Date(t[t.length-1].date).getTime()-e;if(i===0){let l;switch(t[0].severity){case 1:l="var(--timeline-none)";break;case 2:l="var(--timeline-mild)";break;case 3:l="var(--timeline-moderate)";break;case 4:l="var(--timeline-severe)";break;case 5:l="var(--timeline-extreme)";break;default:l="var(--timeline-empty)"}return{background:l}}return{background:`linear-gradient(to right, ${t.map(l=>{let h=(new Date(l.date).getTime()-e)/i*100,u;switch(l.severity){case 1:u="var(--timeline-none)";break;case 2:u="var(--timeline-mild)";break;case 3:u="var(--timeline-moderate)";break;case 4:u="var(--timeline-severe)";break;case 5:u="var(--timeline-extreme)";break;default:u="var(--timeline-empty)"}return`${u} ${h}%`}).join(", ")})`}}onAddClick(t){t.preventDefault(),t.stopPropagation(),this.router.navigate(["/foods/add"],{queryParams:{food:this.food().name}})}onEditClick(t,e){t.preventDefault(),t.stopPropagation(),this.editingReaction.set({reaction:e,isImmediateReaction:e.isImmediateReaction,isDelayedReaction:e.isDelayedReaction})}onReactionTypeClick(){let t=this.editingReaction();t&&((t.isImmediateReaction||t.isDelayedReaction)&&t.reaction.severity===1&&(t.reaction.severity=3),this.editingReaction.set(v({},t)))}onSeverityChange(t){let e=this.editingReaction();e&&(t===1?(e.isImmediateReaction=!1,e.isDelayedReaction=!1):!e.isImmediateReaction&&!e.isDelayedReaction&&(e.isDelayedReaction=!0),e.reaction.severity=t,this.editingReaction.set(v({},e)))}async saveReaction(){let t=this.editingReaction();if(t)try{let e=v({},this.food()),o=e.interactions.findIndex(i=>i.id===t.reaction.id);if(o===-1)return;e.interactions[o]=T(v({},t.reaction),{reacted:t.reaction.severity>1,isImmediateReaction:t.isImmediateReaction,isDelayedReaction:t.isDelayedReaction}),e.dateUpdated=new Date,await this.storage.updateFood(e),this.editingReaction.set(null),this.notificationService.show("Reaction updated successfully","success")}catch(e){this.notificationService.show("Error updating reaction: "+e.message,"error")}}cancelEdit(){this.editingReaction.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-food-card"]],inputs:{food:[1,"food"]},decls:14,vars:2,consts:[[1,"food-card"],[1,"food-header"],[1,"food-controls",3,"click"],["title","Add new reaction",1,"add-button"],[1,"food-title"],[1,"timeline-bar",3,"ngStyle"],[1,"reaction-history"],[1,"reactions-list"],[1,"reaction-entry",3,"severity-none","severity-mild","severity-moderate","severity-severe","severity-extreme"],[1,"reaction-entry"],[1,"edit-reaction-form"],[1,"reaction-options"],[1,"severity-options"],[1,"severity-buttons"],["type","button",1,"severity-button",3,"active"],[1,"reaction-onset"],[1,"edit-actions"],[1,"save-button",3,"click"],[1,"cancel-button",3,"click"],["type","button",1,"severity-button",3,"click"],[3,"severity","size"],[1,"reaction-button","immediate"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"reaction-button","delayed"],[1,"reaction-info"],[1,"reaction-date"],[1,"date"],[1,"time"],[1,"reaction-types",3,"click"],[1,"no-reaction","clickable"],[1,"reaction-notes"],[1,"reaction-type","both","clickable"],[1,"reaction-type","immediate","clickable"],[1,"reaction-type","delayed","clickable"]],template:function(e,o){e&1&&(a(0,"div",0)(1,"details")(2,"summary",1)(3,"div",2),g("click",function(m){return o.onAddClick(m)}),a(4,"button",3),s(5,"+"),r()(),a(6,"div",4)(7,"h3"),s(8),r(),R(9,"div",5),r()(),a(10,"div",6)(11,"div",7),O(12,me,3,11,"div",8,ee),r()()()()),e&2&&(c(8),M(o.food().name),c(),P("ngStyle",o.timelineStyle),c(3),k(o.latestReactions))},dependencies:[W,$,B,U,X,Y,q,K],styles:['.food-card[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;background-color:var(--card-bg);box-shadow:0 2px 4px #0000001a;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;overflow:hidden}details[_ngcontent-%COMP%]{width:100%}details[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{list-style:none}details[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none}.food-header[_ngcontent-%COMP%]{display:flex;cursor:pointer;transition:background-color .2s;-webkit-user-select:none;user-select:none;gap:1rem}.food-header[_ngcontent-%COMP%]:hover{background-color:var(--hover-bg)}.food-title[_ngcontent-%COMP%]{flex:1;padding:1rem 1rem 1rem 0}.food-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;color:var(--text-primary)}.timeline-bar[_ngcontent-%COMP%]{height:8px;border-radius:2px;margin-top:8px;width:100%;background:var(--timeline-empty, #eee)}[_nghost-%COMP%]{--timeline-none: #51cf66;--timeline-mild: #9acd32;--timeline-moderate: #ffd43b;--timeline-severe: #fd7e14;--timeline-extreme: #fa5252}.reaction-summary[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);padding:.25rem .5rem;border-radius:12px;background:var(--bg-secondary)}.reaction-history[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);padding:1rem;background:var(--bg-secondary)}.reactions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.reaction-entry[_ngcontent-%COMP%]{padding:.75rem;background:var(--card-bg);border-radius:8px;border:1px solid var(--border-color);display:flex;flex-direction:column;gap:.75rem;border-left:4px solid transparent}.reaction-entry.severity-none[_ngcontent-%COMP%]{border-left-color:#51cf66}.reaction-entry.severity-mild[_ngcontent-%COMP%]{border-left-color:#9acd32}.reaction-entry.severity-moderate[_ngcontent-%COMP%]{border-left-color:#ffd43b}.reaction-entry.severity-severe[_ngcontent-%COMP%]{border-left-color:#fd7e14}.reaction-entry.severity-extreme[_ngcontent-%COMP%]{border-left-color:#fa5252}.reaction-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.reaction-date[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:var(--text-secondary);line-height:1.2}.reaction-date[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:.9rem}.reaction-date[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:.8rem;opacity:.8}.reaction-types[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;cursor:pointer;transition:opacity .2s}.reaction-types[_ngcontent-%COMP%]:hover{opacity:.8}.reaction-type[_ngcontent-%COMP%]{background:var(--input-bg);padding:.25rem .75rem;border-radius:12px;font-weight:500}.reaction-type.immediate[_ngcontent-%COMP%]{color:#fd7e14;background:#fd7e141a}.reaction-type.delayed[_ngcontent-%COMP%]{color:#ffd43b;background:#ffd43b1a}.reaction-type.both[_ngcontent-%COMP%]{color:#fa5252;background:#fa52521a}.no-reaction[_ngcontent-%COMP%]{color:#51cf66;background:#51cf661a;padding:.25rem .75rem;border-radius:12px;font-weight:500}.reaction-notes[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-primary);white-space:pre-wrap}.no-reactions[_ngcontent-%COMP%]{text-align:center;color:var(--text-secondary);font-style:italic;margin:1rem 0}@media (hover: hover){.food-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0003}}.food-controls[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:0 .5rem;background-color:var(--input-bg)}.add-button[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;border:none;font-size:2rem}.add-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-color-dark)}.add-button[_ngcontent-%COMP%]:focus{outline:2px solid var(--primary-color);outline-offset:2px}.edit-reaction-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.reaction-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.edit-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-end;margin-top:.5rem}.save-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-weight:500;cursor:pointer;transition:background-color .2s}.save-button[_ngcontent-%COMP%]{background-color:var(--text-accent);color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:var(--text-accent-hover, #0056b3)}.cancel-button[_ngcontent-%COMP%]{background-color:var(--bg-secondary);color:var(--text-primary)}.cancel-button[_ngcontent-%COMP%]:hover{background-color:var(--bg-secondary-hover, #e9ecef)}.edit-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.25rem;border-radius:4px;opacity:.6;transition:opacity .2s}.edit-button[_ngcontent-%COMP%]:hover{opacity:1;background:var(--bg-secondary)}.reaction-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.reaction-button[_ngcontent-%COMP%]{flex:1;position:relative;display:flex;justify-content:center;align-items:center;padding:.75rem;border:2px solid var(--input-border);border-radius:12px;background:var(--card-bg);cursor:pointer;transition:all .2s ease}.reaction-button[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}.reaction-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;white-space:nowrap}.reaction-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.reaction-button.active[_ngcontent-%COMP%]{border-color:var(--text-accent);background:var(--input-bg);box-shadow:0 2px 4px #0003}.reaction-button.no-reaction.active[_ngcontent-%COMP%]{border-color:#51cf66;color:#51cf66}.reaction-button.immediate.active[_ngcontent-%COMP%]{border-color:#fd7e14;color:#fd7e14}.reaction-button.delayed.active[_ngcontent-%COMP%]{border-color:#ffd43b;color:#ffd43b}.clickable[_ngcontent-%COMP%]{position:relative}.clickable[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:currentColor;opacity:0;transition:opacity .2s}.reaction-types[_ngcontent-%COMP%]:hover   .clickable[_ngcontent-%COMP%]:after{opacity:.5}.reaction-onset[_ngcontent-%COMP%]{display:flex;gap:1rem}.severity-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:.5rem;border:2px solid var(--input-border);border-radius:12px;background:var(--card-bg)}.severity-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:center}.severity-button[_ngcontent-%COMP%]{background:none;border:2px solid transparent;border-radius:8px;padding:.5rem;cursor:pointer;transition:all .2s ease}.severity-button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);background:var(--bg-secondary)}.severity-button.active[_ngcontent-%COMP%]{border-color:var(--text-accent);background:var(--bg-secondary)}']})};export{Q as FoodCardComponent};
