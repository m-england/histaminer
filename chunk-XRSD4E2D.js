import{E as T,F as y,H as f,I as C,K as I,L as E,M as i,N as a,O as V,P as k,Q as _,R as d,V as l,W as v,X as N,Y as h,Z as M,_ as R,a as u,aa as w,b as F,ba as O,ea as W,ia as z,ja as j,ka as B,na as A,o as x,q as m,r as p,ta as L,u as D,va as $,w as c,wa as q,xa as Y,y as S,ya as U,za as G}from"./chunk-XYZNQMXL.js";var J=(o,t)=>t.date;function K(o,t){if(o&1){let e=k();i(0,"div",9)(1,"div",10)(2,"label",11)(3,"input",12),R("ngModelChange",function(n){m(e);let s=d(2);return M(s.editingReaction().isNoReaction,n)||(s.editingReaction().isNoReaction=n),p(n)}),_("ngModelChange",function(){m(e);let n=d(2);return p(n.onNoReactionClick())}),a(),i(4,"span"),l(5,"\u{1F7E2} No Reaction"),a()(),i(6,"label",13)(7,"input",12),R("ngModelChange",function(n){m(e);let s=d(2);return M(s.editingReaction().isImmediateReaction,n)||(s.editingReaction().isImmediateReaction=n),p(n)}),_("ngModelChange",function(){m(e);let n=d(2);return p(n.onReactionTypeClick())}),a(),i(8,"span"),l(9,"\u{1F534} Immediate Reaction"),a()(),i(10,"label",14)(11,"input",12),R("ngModelChange",function(n){m(e);let s=d(2);return M(s.editingReaction().isDelayedReaction,n)||(s.editingReaction().isDelayedReaction=n),p(n)}),_("ngModelChange",function(){m(e);let n=d(2);return p(n.onReactionTypeClick())}),a(),i(12,"span"),l(13,"\u23F0 Delayed Reaction"),a()()(),i(14,"div",15)(15,"button",16),_("click",function(){m(e);let n=d(2);return p(n.saveReaction())}),l(16,"Save"),a(),i(17,"button",17),_("click",function(){m(e);let n=d(2);return p(n.cancelEdit())}),l(18,"Cancel"),a()()()}if(o&2){let e=d(2);c(2),y("active",e.editingReaction().isNoReaction),c(),h("ngModel",e.editingReaction().isNoReaction),c(3),y("active",e.editingReaction().isImmediateReaction),c(),h("ngModel",e.editingReaction().isImmediateReaction),c(3),y("active",e.editingReaction().isDelayedReaction),c(),h("ngModel",e.editingReaction().isDelayedReaction)}}function Q(o,t){o&1&&(i(0,"span",23),l(1,"\u{1F7E2} No reaction"),a())}function X(o,t){o&1&&(i(0,"span",25),l(1,"\u26A1 Both"),a())}function Z(o,t){o&1&&(i(0,"span",26),l(1,"\u{1F534} Immediate"),a())}function ee(o,t){o&1&&(i(0,"span",27),l(1,"\u23F0 Delayed"),a())}function te(o,t){if(o&1&&f(0,X,2,0,"span",25)(1,Z,2,0,"span",26)(2,ee,2,0,"span",27),o&2){let e=d(2).$implicit;C(e.isImmediateReaction&&e.isDelayedReaction?0:e.isImmediateReaction?1:e.isDelayedReaction?2:-1)}}function ne(o,t){if(o&1&&(i(0,"div",24),l(1),a()),o&2){let e=d(2).$implicit;c(),N(" ",e.notes," ")}}function oe(o,t){if(o&1){let e=k();i(0,"div",18)(1,"div",19)(2,"div",20),l(3),w(4,"date"),a(),i(5,"div",21),l(6),w(7,"date"),a()(),i(8,"div",22),_("click",function(n){m(e);let s=d().$implicit,g=d();return p(g.onEditClick(n,s))}),f(9,Q,2,0,"span",23)(10,te,3,1),a()(),f(11,ne,2,1,"div",24)}if(o&2){let e=d().$implicit;c(3),v(O(4,4,e.date,"mediumDate")),c(3),v(O(7,7,e.date,"shortTime")),c(3),C(e.reacted?10:9),c(2),C(e.notes?11:-1)}}function ie(o,t){if(o&1&&(i(0,"div",8),f(1,K,19,9,"div",9)(2,oe,12,10),a()),o&2){let e=t.$implicit,r=d();c(),C(r.editingReaction()!==null&&r.editingReaction().reaction.id===e.id?1:2)}}var H=class o{router=x(A);storage=x(G);notificationService=x(U);food=W.required();maxReactions=10;editingReaction=D(null);get latestReactions(){return[...this.food().interactions].sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()).slice(0,this.maxReactions)}get reactionsCount(){return this.food().interactions.filter(t=>t.reacted).length}get timelineStyle(){let t=[...this.food().interactions].sort((g,P)=>new Date(g.date).getTime()-new Date(P.date).getTime());if(t.length===0)return{background:"var(--timeline-empty, #eee)"};let e=new Date(t[0].date).getTime(),n=new Date(t[t.length-1].date).getTime()-e;return n===0?t[0].reacted?{background:t[0].isImmediateReaction&&t[0].isDelayedReaction?"var(--timeline-both, #fa5252)":t[0].isImmediateReaction?"var(--timeline-immediate, #fd7e14)":"var(--timeline-delayed, #ffd43b)"}:{background:"var(--timeline-safe, #51cf66)"}:{background:`linear-gradient(to right, ${t.map(g=>{let P=(new Date(g.date).getTime()-e)/n*100,b;return g.reacted?g.isImmediateReaction&&g.isDelayedReaction?b="var(--timeline-both, #fa5252)":b=g.isImmediateReaction?"var(--timeline-immediate, #fd7e14)":"var(--timeline-delayed, #ffd43b)":b="var(--timeline-safe, #51cf66)",`${b} ${P}%`}).join(", ")})`}}onAddClick(t){t.preventDefault(),t.stopPropagation(),this.router.navigate(["/foods/add"],{queryParams:{food:this.food().name}})}onEditClick(t,e){t.preventDefault(),t.stopPropagation(),this.editingReaction.set({reaction:e,isNoReaction:!e.reacted,isImmediateReaction:e.isImmediateReaction,isDelayedReaction:e.isDelayedReaction})}onNoReactionClick(){let t=this.editingReaction();t&&(t.isNoReaction&&(t.isImmediateReaction=!1,t.isDelayedReaction=!1),this.editingReaction.set(u({},t)))}onReactionTypeClick(){let t=this.editingReaction();t&&(t.isNoReaction=!t.isImmediateReaction&&!t.isDelayedReaction,this.editingReaction.set(u({},t)))}async saveReaction(){let t=this.editingReaction();if(t)try{let e=u({},this.food()),r=e.interactions.findIndex(n=>n.id===t.reaction.id);if(r===-1)return;e.interactions[r]=F(u({},t.reaction),{reacted:!t.isNoReaction,isImmediateReaction:t.isImmediateReaction,isDelayedReaction:t.isDelayedReaction}),e.dateUpdated=new Date,await this.storage.updateFood(e),this.editingReaction.set(null)}catch(e){this.notificationService.show("Error updating reaction: "+e.message,"error")}}cancelEdit(){this.editingReaction.set(null)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=S({type:o,selectors:[["app-food-card"]],inputs:{food:[1,"food"]},decls:14,vars:2,consts:[[1,"food-card"],[1,"food-header"],[1,"food-controls",3,"click"],["title","Add new reaction",1,"add-button"],[1,"food-title"],[1,"timeline-bar",3,"ngStyle"],[1,"reaction-history"],[1,"reactions-list"],[1,"reaction-entry"],[1,"edit-reaction-form"],[1,"reaction-options"],[1,"reaction-button","no-reaction"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"reaction-button","immediate"],[1,"reaction-button","delayed"],[1,"edit-actions"],[1,"save-button",3,"click"],[1,"cancel-button",3,"click"],[1,"reaction-info"],[1,"reaction-date"],[1,"date"],[1,"time"],[1,"reaction-types",3,"click"],[1,"no-reaction","clickable"],[1,"reaction-notes"],[1,"reaction-type","both","clickable"],[1,"reaction-type","immediate","clickable"],[1,"reaction-type","delayed","clickable"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"details")(2,"summary",1)(3,"div",2),_("click",function(s){return r.onAddClick(s)}),i(4,"button",3),l(5,"+"),a()(),i(6,"div",4)(7,"h3"),l(8),a(),V(9,"div",5),a()(),i(10,"div",6)(11,"div",7),I(12,ie,3,1,"div",8,J),a()()()()),e&2&&(c(8),v(r.food().name),c(),T("ngStyle",r.timelineStyle),c(3),E(r.latestReactions))},dependencies:[B,z,j,Y,L,$,q],styles:['.food-card[_ngcontent-%COMP%]{border:1px solid var(--border-color);border-radius:8px;background-color:var(--card-bg);box-shadow:0 2px 4px #0000001a;transition:transform .2s ease,box-shadow .2s ease;touch-action:manipulation;overflow:hidden}details[_ngcontent-%COMP%]{width:100%}details[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{list-style:none}details[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none}.food-header[_ngcontent-%COMP%]{display:flex;cursor:pointer;transition:background-color .2s;-webkit-user-select:none;user-select:none;gap:1rem}.food-header[_ngcontent-%COMP%]:hover{background-color:var(--hover-bg)}.food-title[_ngcontent-%COMP%]{flex:1;padding:1rem 1rem 1rem 0}.food-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;color:var(--text-primary)}.timeline-bar[_ngcontent-%COMP%]{height:8px;border-radius:2px;margin-top:8px;width:100%;background:var(--timeline-empty, #eee)}[_nghost-%COMP%]{--timeline-immediate: #fd7e14;--timeline-delayed: #ffd43b;--timeline-safe: #51cf66;--timeline-both: #fa5252;--timeline-empty: #eee}.reaction-summary[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);padding:.25rem .5rem;border-radius:12px;background:var(--bg-secondary)}.reaction-history[_ngcontent-%COMP%]{border-top:1px solid var(--border-color);padding:1rem;background:var(--bg-secondary)}.reactions-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.reaction-entry[_ngcontent-%COMP%]{padding:.75rem;background:var(--card-bg);border-radius:8px;border:1px solid var(--border-color);display:flex;flex-direction:column;gap:.75rem}.reaction-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.reaction-date[_ngcontent-%COMP%]{display:flex;flex-direction:column;color:var(--text-secondary);line-height:1.2}.reaction-date[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:.9rem}.reaction-date[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:.8rem;opacity:.8}.reaction-types[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;cursor:pointer;transition:opacity .2s}.reaction-types[_ngcontent-%COMP%]:hover{opacity:.8}.reaction-type[_ngcontent-%COMP%]{background:var(--input-bg);padding:.25rem .75rem;border-radius:12px;font-weight:500}.reaction-type.immediate[_ngcontent-%COMP%]{color:#fd7e14;background:#fd7e141a}.reaction-type.delayed[_ngcontent-%COMP%]{color:#ffd43b;background:#ffd43b1a}.reaction-type.both[_ngcontent-%COMP%]{color:#fa5252;background:#fa52521a}.no-reaction[_ngcontent-%COMP%]{color:#51cf66;background:#51cf661a;padding:.25rem .75rem;border-radius:12px;font-weight:500}.reaction-notes[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-primary);white-space:pre-wrap}.no-reactions[_ngcontent-%COMP%]{text-align:center;color:var(--text-secondary);font-style:italic;margin:1rem 0}@media (hover: hover){.food-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0003}}.food-controls[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:0 .5rem;background-color:var(--input-bg)}.add-button[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff;border:none;font-size:2rem}.add-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-color-dark)}.add-button[_ngcontent-%COMP%]:focus{outline:2px solid var(--primary-color);outline-offset:2px}.edit-reaction-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.reaction-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.edit-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-end;margin-top:.5rem}.save-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-weight:500;cursor:pointer;transition:background-color .2s}.save-button[_ngcontent-%COMP%]{background-color:var(--text-accent);color:#fff}.save-button[_ngcontent-%COMP%]:hover{background-color:var(--text-accent-hover, #0056b3)}.cancel-button[_ngcontent-%COMP%]{background-color:var(--bg-secondary);color:var(--text-primary)}.cancel-button[_ngcontent-%COMP%]:hover{background-color:var(--bg-secondary-hover, #e9ecef)}.edit-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.25rem;border-radius:4px;opacity:.6;transition:opacity .2s}.edit-button[_ngcontent-%COMP%]:hover{opacity:1;background:var(--bg-secondary)}.reaction-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.reaction-button[_ngcontent-%COMP%]{flex:1;position:relative;display:flex;justify-content:center;align-items:center;padding:.75rem;border:2px solid var(--input-border);border-radius:12px;background:var(--card-bg);cursor:pointer;transition:all .2s ease}.reaction-button[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}.reaction-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;white-space:nowrap}.reaction-button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.reaction-button.active[_ngcontent-%COMP%]{border-color:var(--text-accent);background:var(--input-bg);box-shadow:0 2px 4px #0003}.reaction-button.no-reaction.active[_ngcontent-%COMP%]{border-color:#51cf66;color:#51cf66}.reaction-button.immediate.active[_ngcontent-%COMP%]{border-color:#fd7e14;color:#fd7e14}.reaction-button.delayed.active[_ngcontent-%COMP%]{border-color:#ffd43b;color:#ffd43b}.clickable[_ngcontent-%COMP%]{position:relative}.clickable[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:currentColor;opacity:0;transition:opacity .2s}.reaction-types[_ngcontent-%COMP%]:hover   .clickable[_ngcontent-%COMP%]:after{opacity:.5}']})};export{H as FoodCardComponent};
